<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Milk Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        .icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const MilkTracker = () => {
            const [records, setRecords] = useState([]);
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({
                date: new Date().toISOString().split('T')[0],
                quantity: '',
                pricePerLitre: '',
                totalAmount: ''
            });
            const [summaryPeriod, setSummaryPeriod] = useState('weekly');

            // Load data on start
            useEffect(() => {
                const savedData = window.milkTrackerData || [];
                setRecords(savedData);
            }, []);

            // Save data whenever records change
            useEffect(() => {
                window.milkTrackerData = records;
            }, [records]);

            // Calculate total when quantity or price changes
            useEffect(() => {
                if (formData.quantity && formData.pricePerLitre) {
                    const total = (parseFloat(formData.quantity) * parseFloat(formData.pricePerLitre)).toFixed(2);
                    setFormData(prev => ({ ...prev, totalAmount: total }));
                }
            }, [formData.quantity, formData.pricePerLitre]);

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = () => {
                if (!formData.date || !formData.quantity || !formData.pricePerLitre) {
                    alert('Please fill in all fields');
                    return;
                }

                const newRecord = {
                    id: editingId || Date.now(),
                    date: formData.date,
                    quantity: parseFloat(formData.quantity),
                    pricePerLitre: parseFloat(formData.pricePerLitre),
                    totalAmount: parseFloat(formData.totalAmount)
                };

                let newRecords;
                if (editingId) {
                    newRecords = records.map(record => 
                        record.id === editingId ? newRecord : record
                    );
                    setEditingId(null);
                } else {
                    newRecords = [...records, newRecord];
                }

                setRecords(newRecords);
                setFormData({
                    date: new Date().toISOString().split('T')[0],
                    quantity: '',
                    pricePerLitre: '',
                    totalAmount: ''
                });
                setShowForm(false);
            };

            const handleEdit = (record) => {
                setFormData({
                    date: record.date,
                    quantity: record.quantity.toString(),
                    pricePerLitre: record.pricePerLitre.toString(),
                    totalAmount: record.totalAmount.toString()
                });
                setEditingId(record.id);
                setShowForm(true);
            };

            const handleDelete = (id) => {
                if (window.confirm('Are you sure you want to delete this record?')) {
                    const newRecords = records.filter(record => record.id !== id);
                    setRecords(newRecords);
                }
            };

            const cancelEdit = () => {
                setEditingId(null);
                setShowForm(false);
                setFormData({
                    date: new Date().toISOString().split('T')[0],
                    quantity: '',
                    pricePerLitre: '',
                    totalAmount: ''
                });
            };

            const getDateRange = (period) => {
                const today = new Date();
                const startDate = new Date();

                switch (period) {
                    case 'weekly':
                        startDate.setDate(today.getDate() - 7);
                        break;
                    case 'fortnightly':
                        startDate.setDate(today.getDate() - 14);
                        break;
                    case 'monthly':
                        startDate.setMonth(today.getMonth() - 1);
                        break;
                    case 'halfyearly':
                        startDate.setMonth(today.getMonth() - 6);
                        break;
                    case 'yearly':
                        startDate.setFullYear(today.getFullYear() - 1);
                        break;
                    default:
                        startDate.setDate(today.getDate() - 7);
                }

                return { startDate, endDate: today };
            };

            const calculateSummary = (period) => {
                const { startDate, endDate } = getDateRange(period);
                
                const filteredRecords = records.filter(record => {
                    const recordDate = new Date(record.date);
                    return recordDate >= startDate && recordDate <= endDate;
                });

                const totalQuantity = filteredRecords.reduce((sum, record) => sum + record.quantity, 0);
                const totalAmount = filteredRecords.reduce((sum, record) => sum + record.totalAmount, 0);
                const averagePrice = totalQuantity > 0 ? totalAmount / totalQuantity : 0;

                return {
                    totalQuantity: totalQuantity.toFixed(2),
                    totalAmount: totalAmount.toFixed(2),
                    averagePrice: averagePrice.toFixed(2),
                    recordCount: filteredRecords.length
                };
            };

            const exportData = () => {
                const dataStr = JSON.stringify(records, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `milk-records-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            };

            const sortedRecords = [...records].sort((a, b) => new Date(b.date) - new Date(a.date));
            const summary = calculateSummary(summaryPeriod);

            return (
                <div style={{minHeight: '100vh', background: 'linear-gradient(135deg, #e0f2fe 0%, #e8f5e8 100%)', padding: '16px'}}>
                    <div style={{maxWidth: '1200px', margin: '0 auto'}}>
                        <div style={{background: 'white', borderRadius: '12px', boxShadow: '0 4px 6px rgba(0,0,0,0.1)', padding: '24px', marginBottom: '24px'}}>
                            
                            {/* Header */}
                            <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px', flexWrap: 'wrap', gap: '12px'}}>
                                <h1 style={{fontSize: '28px', fontWeight: 'bold', color: '#1f2937', margin: 0}}>ü•õ Daily Milk Tracker</h1>
                                <div style={{display: 'flex', gap: '8px', flexWrap: 'wrap'}}>
                                    <button
                                        onClick={() => setShowForm(!showForm)}
                                        style={{background: '#2563eb', color: 'white', padding: '12px 16px', borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500'}}
                                    >
                                        ‚ûï Add Record
                                    </button>
                                    <button
                                        onClick={exportData}
                                        style={{background: '#059669', color: 'white', padding: '12px 16px', borderRadius: '8px', border: 'none', cursor: 'pointer', fontSize: '14px'}}
                                        title="Export Data"
                                    >
                                        üì• Export
                                    </button>
                                </div>
                            </div>

                            {/* Add/Edit Form */}
                            {showForm && (
                                <div style={{background: '#f9fafb', borderRadius: '8px', padding: '24px', marginBottom: '24px'}}>
                                    <h3 style={{fontSize: '18px', fontWeight: '600', marginBottom: '16px', color: '#374151'}}>
                                        {editingId ? 'Edit Record' : 'Add New Record'}
                                    </h3>
                                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px'}}>
                                        <div>
                                            <label style={{display: 'block', fontSize: '14px', fontWeight: '500', color: '#374151', marginBottom: '4px'}}>Date</label>
                                            <input
                                                type="date"
                                                name="date"
                                                value={formData.date}
                                                onChange={handleInputChange}
                                                style={{width: '100%', padding: '8px 12px', border: '2px solid #d1d5db', borderRadius: '6px', fontSize: '14px'}}
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label style={{display: 'block', fontSize: '14px', fontWeight: '500', color: '#374151', marginBottom: '4px'}}>Quantity (Litres)</label>
                                            <input
                                                type="number"
                                                name="quantity"
                                                value={formData.quantity}
                                                onChange={handleInputChange}
                                                step="0.01"
                                                min="0"
                                                placeholder="e.g. 2.5"
                                                style={{width: '100%', padding: '8px 12px', border: '2px solid #d1d5db', borderRadius: '6px', fontSize: '14px'}}
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label style={{display: 'block', fontSize: '14px', fontWeight: '500', color: '#374151', marginBottom: '4px'}}>Price per Litre (‚Çπ)</label>
                                            <input
                                                type="number"
                                                name="pricePerLitre"
                                                value={formData.pricePerLitre}
                                                onChange={handleInputChange}
                                                step="0.01"
                                                min="0"
                                                placeholder="e.g. 45.00"
                                                style={{width: '100%', padding: '8px 12px', border: '2px solid #d1d5db', borderRadius: '6px', fontSize: '14px'}}
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label style={{display: 'block', fontSize: '14px', fontWeight: '500', color: '#374151', marginBottom: '4px'}}>Total Amount (‚Çπ)</label>
                                            <input
                                                type="number"
                                                name="totalAmount"
                                                value={formData.totalAmount}
                                                readOnly
                                                style={{width: '100%', padding: '8px 12px', border: '2px solid #d1d5db', borderRadius: '6px', fontSize: '14px', background: '#f3f4f6'}}
                                                placeholder="Auto-calculated"
                                            />
                                        </div>
                                    </div>
                                    <div style={{marginTop: '16px', display: 'flex', gap: '8px', flexWrap: 'wrap'}}>
                                        <button
                                            onClick={handleSubmit}
                                            style={{background: '#059669', color: 'white', padding: '10px 16px', borderRadius: '6px', border: 'none', cursor: 'pointer', fontSize: '14px', fontWeight: '500'}}
                                        >
                                            üíæ {editingId ? 'Update Record' : 'Save Record'}
                                        </button>
                                        <button
                                            onClick={cancelEdit}
                                            style={{background: '#6b7280', color: 'white', padding: '10px 16px', borderRadius: '6px', border: 'none', cursor: 'pointer', fontSize: '14px'}}
                                        >
                                            ‚ùå Cancel
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Summary Section */}
                            <div style={{background: 'linear-gradient(135deg, #dcfce7 0%, #dbeafe 100%)', borderRadius: '8px', padding: '24px', marginBottom: '24px'}}>
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px', flexWrap: 'wrap', gap: '12px'}}>
                                    <h3 style={{fontSize: '18px', fontWeight: '600', color: '#374151', margin: 0}}>üìä Summary</h3>
                                    <select
                                        value={summaryPeriod}
                                        onChange={(e) => setSummaryPeriod(e.target.value)}
                                        style={{padding: '8px 12px', border: '2px solid #d1d5db', borderRadius: '6px', fontSize: '14px'}}
                                    >
                                        <option value="weekly">Last 7 Days</option>
                                        <option value="fortnightly">Last 14 Days</option>
                                        <option value="monthly">Last 30 Days</option>
                                        <option value="halfyearly">Last 6 Months</option>
                                        <option value="yearly">Last 12 Months</option>
                                    </select>
                                </div>
                                <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '16px'}}>
                                    <div style={{background: 'white', borderRadius: '8px', padding: '16px', textAlign: 'center', boxShadow: '0 1px 3px rgba(0,0,0,0.1)'}}>
                                        <div style={{fontSize: '24px', fontWeight: 'bold', color: '#2563eb'}}>{summary.totalQuantity}L</div>
                                        <div style={{fontSize: '12px', color: '#6b7280'}}>Total Quantity</div>
                                    </div>
                                    <div style={{background: 'white', borderRadius: '8px', padding: '16px', textAlign: 'center', boxShadow: '0 1px 3px rgba(0,0,0,0.1)'}}>
                                        <div style={{fontSize: '24px', fontWeight: 'bold', color: '#059669'}}>‚Çπ{summary.totalAmount}</div>
                                        <div style={{fontSize: '12px', color: '#6b7280'}}>Total Amount</div>
                                    </div>
                                    <div style={{background: 'white', borderRadius: '8px', padding: '16px', textAlign: 'center', boxShadow: '0 1px 3px rgba(0,0,0,0.1)'}}>
                                        <div style={{fontSize: '24px', fontWeight: 'bold', color: '#7c3aed'}}>‚Çπ{summary.averagePrice}</div>
                                        <div style={{fontSize: '12px', color: '#6b7280'}}>Avg Price/Litre</div>
                                    </div>
                                    <div style={{background: 'white', borderRadius: '8px', padding: '16px', textAlign: 'center', boxShadow: '0 1px 3px rgba(0,0,0,0.1)'}}>
                                        <div style={{fontSize: '24px', fontWeight: 'bold', color: '#ea580c'}}>{summary.recordCount}</div>
                                        <div style={{fontSize: '12px', color: '#6b7280'}}>Total Records</div>
                                    </div>
                                </div>
                            </div>

                            {/* Records Table */}
                            <div style={{background: 'white', borderRadius: '8px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)', overflow: 'hidden'}}>
                                <div style={{padding: '16px 24px', borderBottom: '1px solid #e5e7eb'}}>
                                    <h3 style={{fontSize: '18px', fontWeight: '600', color: '#374151', margin: 0}}>
                                        Milk Records ({records.length} total)
                                    </h3>
                                </div>
                                <div style={{overflowX: 'auto'}}>
                                    <table style={{width: '100%', borderCollapse: 'collapse'}}>
                                        <thead style={{background: '#f9fafb'}}>
                                            <tr>
                                                <th style={{padding: '12px 16px', textAlign: 'left', fontSize: '12px', fontWeight: '500', color: '#6b7280', textTransform: 'uppercase'}}>Date</th>
                                                <th style={{padding: '12px 16px', textAlign: 'left', fontSize: '12px', fontWeight: '500', color: '#6b7280', textTransform: 'uppercase'}}>Quantity (L)</th>
                                                <th style={{padding: '12px 16px', textAlign: 'left', fontSize: '12px', fontWeight: '500', color: '#6b7280', textTransform: 'uppercase'}}>Price/L (‚Çπ)</th>
                                                <th style={{padding: '12px 16px', textAlign: 'left', fontSize: '12px', fontWeight: '500', color: '#6b7280', textTransform: 'uppercase'}}>Total (‚Çπ)</th>
                                                <th style={{padding: '12px 16px', textAlign: 'left', fontSize: '12px', fontWeight: '500', color: '#6b7280', textTransform: 'uppercase'}}>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody style={{background: 'white'}}>
                                            {sortedRecords.length === 0 ? (
                                                <tr>
                                                    <td colSpan="5" style={{padding: '48px 24px', textAlign: 'center', color: '#6b7280'}}>
                                                        <div>
                                                            <div style={{fontSize: '48px', marginBottom: '16px'}}>ü•õ</div>
                                                            <p style={{fontSize: '18px', fontWeight: '500', margin: '0 0 8px 0'}}>No milk records yet</p>
                                                            <p style={{fontSize: '14px', margin: 0}}>Click "Add Record" to start tracking your daily milk purchases</p>
                                                        </div>
                                                    </td>
                                                </tr>
                                            ) : (
                                                sortedRecords.map((record, index) => (
                                                    <tr key={record.id} style={{borderBottom: '1px solid #f3f4f6', background: index % 2 === 0 ? 'white' : '#f9fafb'}}>
                                                        <td style={{padding: '16px', fontSize: '14px', fontWeight: '500', color: '#111827'}}>
                                                            {new Date(record.date).toLocaleDateString('en-IN', {
                                                                day: '2-digit',
                                                                month: 'short',
                                                                year: 'numeric'
                                                            })}
                                                        </td>
                                                        <td style={{padding: '16px', fontSize: '14px', color: '#111827'}}>{record.quantity}</td>
                                                        <td style={{padding: '16px', fontSize: '14px', color: '#111827'}}>‚Çπ{record.pricePerLitre}</td>
                                                        <td style={{padding: '16px', fontSize: '14px', fontWeight: '500', color: '#111827'}}>‚Çπ{record.totalAmount}</td>
                                                        <td style={{padding: '16px', fontSize: '14px', fontWeight: '500'}}>
                                                            <div style={{display: 'flex', gap: '8px'}}>
                                                                <button
                                                                    onClick={() => handleEdit(record)}
                                                                    style={{padding: '8px', color: '#2563eb', background: 'transparent', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '16px'}}
                                                                    title="Edit Record"
                                                                >
                                                                    ‚úèÔ∏è
                                                                </button>
                                                                <button
                                                                    onClick={() => handleDelete(record.id)}
                                                                    style={{padding: '8px', color: '#dc2626', background: 'transparent', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '16px'}}
                                                                    title="Delete Record"
                                                                >
                                                                    üóëÔ∏è
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            {records.length > 0 && (
                                <div style={{marginTop: '16px', textAlign: 'center', fontSize: '14px', color: '#6b7280'}}>
                                    üí° Tip: Use the export button to backup your data regularly
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<MilkTracker />, document.getElementById('root'));
    </script>
</body>
</html>